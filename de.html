<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROS2 Developer Panel - Final</title>

    <!-- External JavaScript -->
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    
    <style>
        /* --- CSS Variables (Theme) --- */
        :root {
            --color-bg-terminal: #030712;
            --color-bg-panel: #1a1a1a;
            --color-bg-panel-alt: #262626;
            --color-bg-item: #2a2a2a;
            --color-bg-item-hover: #242424;
            --color-bg-header: #333333;
            --color-bg-input: #1a1a1a;
            --color-text-primary: #d4d4d4;
            --color-text-secondary: #a3a3a3;
            --color-text-header: #ffffff;
            --color-border-primary: #00000033;
            --color-border-secondary: #3f3f46;
            --color-accent-primary: #b81830;
            --color-accent-positive: #22c55e;
            --color-accent-positive-hover: #16a34a;
            --font-family-sans: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-family-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
        }

        /* --- Base & Global Styles --- */
        [x-cloak] { display: none !important; }
        body { height: 100vh; margin: 0; background-color: var(--color-bg-terminal); color: var(--color-text-primary); font-family: var(--font-family-sans); overflow: hidden; }
        body.is-resizing, body.is-resizing * { cursor: col-resize !important; user-select: none !important; }

        /* --- Custom Scrollbar --- */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: var(--color-bg-panel); }
        .custom-scroll::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #555; }

        /* --- Main Layout --- */
        .app-container { display: flex; flex-direction: column; height: 100%; }
        .app-header { height: 3rem; background-color: var(--color-accent-primary); display: flex; align-items: center; padding: 0 1rem; border-bottom: 1px solid var(--color-border-primary); flex-shrink: 0; }
        .app-header__title { font-size: 1.5rem; font-weight: 700; color: var(--color-text-header); }
        .app-header__subtitle { font-size: 1.125rem; font-weight: 300; color: rgba(255, 255, 255, 0.8); margin-left: 0.75rem; }
        .panel-container { display: flex; flex-grow: 1; }

        /* --- Panels --- */
        .panel { display: flex; flex-direction: column; }
        .panel--left { background-color: var(--color-bg-panel); }
        .panel--right { background-color: var(--color-bg-terminal); }
        .panel--full-width { width: 100% !important; }
        .panel__header { height: 2.5rem; background-color: #1F2937; border-bottom: 1px solid var(--color-border-secondary); display: flex; align-items: center; justify-content: space-between; padding: 0 1rem; flex-shrink: 0; }
        .panel__header-title { font-size: 0.875rem; font-weight: 500; }
        .panel__content { flex-grow: 1; overflow-y: auto; padding: 0.75rem; font-family: var(--font-family-mono); font-size: 0.75rem; line-height: 1.7; }
        .panel__content .terminal-line--input { color: var(--color-accent-positive); }
        .panel__content .terminal-cursor { animation: blink 1s step-end infinite; }
        @keyframes blink { from, to { background-color: transparent; } 50% { background-color: var(--color-accent-positive); } }

        /* --- Panel Collapse Indicators --- */
        .panel-collapse-indicator { width: 1.5rem; height: 100%;  background-color: #1F2937; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .panel-collapse-indicator:hover { background-color: var(--color-accent-primary); }
        .panel-collapse-indicator svg { width: 2rem; height: 2rem; color: var(--color-text-secondary); }
        .panel-collapse-indicator:hover svg { color: var(--color-text-header); }
        .panel-collapse-indicator__icon--right { margin-left: -0.5rem; }
        .panel-collapse-indicator__icon--left { margin-left: -0.5rem; }

        /* --- Resize Handle --- */
        .resize-handle { width: 1.5rem; background-color: #1F2937; cursor: col-resize; display: flex; flex-direction: column; transition: background-color 0.2s; flex-shrink: 0; }
        .resize-handle:hover, .resize-handle.is-active { background-color: var(--color-accent-primary); }
        .resize-handle__reset-button-wrapper { height: 2.5rem; width: 100%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .resize-handle__dots-wrapper { flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        .resize-handle__dots { display: flex; justify-content: center; align-items: center; gap: 0.25rem; }
        .resize-handle__dot { width: 0.25rem; height: 1.5rem; background-color: rgba(255, 255, 255, 0.6); border-radius: 9999px; }
        .resize-handle:hover .resize-handle__dot { background-color: rgba(255, 255, 255, 0.9); }

        /* --- Tabs --- */
        .tabs-header { height: 2.5rem; background-color: var(--color-bg-header); display: grid; grid-template-columns: 1fr auto; align-items: center; border-bottom: 1px solid var(--color-border-secondary); flex-shrink: 0; }
        .tabs-container { display: flex; height: 100%; min-width: 0; }
        .tab { flex: 1; min-width: 0; height: 100%; background-color: #1F2937; border-right: 1px solid var(--color-border-secondary); display: flex; align-items: center; padding: 0 0.75rem; cursor: pointer; transition: background-color 0.2s; }
        .tab:hover { background-color: #253444; }
        .tab.is-active { background-color: #1a2332; z-index: 10; }
        .tab.is-dragging { opacity: 0.4; }
        .tab.is-drag-over { box-shadow: inset 0 -2px 0 var(--color-accent-primary); }
        .tab__name { flex-grow: 1; font-size: 0.75rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--color-text-secondary); }
        .tab.is-active .tab__name { color: var(--color-text-header); }

        /* --- Icon Button Base --- */
        .icon-button { background: none; border: none; cursor: pointer; padding: 0; color: var(--color-text-secondary); transition: color 0.2s; }
        .icon-button:hover { color: var(--color-text-header); }
        .icon-button svg { width: 1.25rem; height: 1.25rem; }
        .icon-button--close { margin-left: 0.5rem; }

        /* --- Tabs Actions --- */
        .tabs-actions { display: flex; align-items: center; height: 100%; background-color: #1F2937; }
        .tabs-actions__button { height: 100%; padding: 0 0.75rem; display: flex; align-items: center; transition: all 0.2s; color: var(--color-text-secondary); background: none; border: none; cursor: pointer; }
        .tabs-actions__button:hover { color: var(--color-text-header); }
        .tabs-actions__button--add { color: var(--color-accent-positive); }
        .tabs-actions__button--add:hover { color: var(--color-accent-positive-hover); }
        .tabs-actions__button:disabled { color: #4b5563; cursor: not-allowed; }
        .tabs-actions__button svg { width: 1.25rem; height: 1.25rem; }

        /* --- Tab Content & Inputs --- */
        .tab-content { overflow-y: auto; flex-grow: 1; }
        .tab-content__sticky-header { position: sticky; top: 0; background-color: var(--color-bg-panel); z-index: 10; padding: 1rem; }
        .tab-content__title { font-size: 1.25rem; font-weight: 700; color: var(--color-text-header); }
        .input-list { padding-top: 1rem; }
        .input-item { height: 3rem; display: flex; justify-content: space-between; align-items: center; padding: 0 1rem; background-color: var(--color-bg-item); border-bottom: 1px solid var(--color-bg-panel); }
        .input-item:hover { background-color: var(--color-bg-item-hover); }
        .input-item__label { display: flex; align-items: baseline; gap: 1rem; }
        .input-item__name { font-size: 0.875rem; color: var(--color-text-primary); }
        .input-item__type { font-size: 0.75rem; font-family: var(--font-family-mono); color: var(--color-text-secondary); }
        .input-field { background-color: var(--color-bg-input); border: 1px solid var(--color-border-secondary); color: var(--color-text-header); padding: 0.5rem 0.625rem; border-radius: 0.25rem; font-size: 0.875rem; width: 11rem; }
        .input-field:focus { outline: none; border-color: #6b7280; }
        .input-field--checkbox { width: 1rem; height: 1rem; accent-color: var(--color-accent-primary); }
        
        /* --- Expandable Object Input --- */
        .input-item--expandable { display: block; height: auto; padding: 0; background-color: transparent; }
        .input-item--expandable summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 3rem;
            padding: 0 1rem;
            cursor: pointer;
            list-style: none;
            background-color: var(--color-bg-item);
            user-select: none; /* MODIFICATION: Prevents text selection on click */
        }
        .input-item--expandable summary::-webkit-details-marker { display: none; }
        .input-item--expandable summary:hover { background-color: var(--color-bg-item-hover); }
        .input-item--expandable .chevron-icon { width: 1rem; height: 1rem; color: var(--color-text-header); transition: transform 0.2s ease-in-out; }
        .input-item--expandable[open] > summary .chevron-icon { transform: rotate(90deg); }
        .input-item__children { padding-left: 1.5rem; margin-left: 1rem; border-left: 2px solid white; }

        /* --- Tooltip --- */
        .tooltip { position: absolute; z-index: 50; padding: 0.25rem 0.5rem; font-size: 0.75rem; color: var(--color-text-header); background-color: var(--color-bg-header); border-radius: 0.25rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); transform: translate(-50%, -100%); }
        .tooltip__arrow { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-width: 4px; border-style: solid; border-color: var(--color-bg-header) transparent transparent transparent; }
    </style>
</head>

<body x-data="panelManager">

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1 class="app-header__title">ROS2</h1>
            <span class="app-header__subtitle">Developer Panel</span>
        </header>

        <!-- Main Content -->
        <main class="panel-container" x-ref="container">

            <!-- Left Panel Collapsed Indicator -->
            <div x-show="leftPanelCollapsed" x-cloak @click="leftPanelCollapsed = false; resetSplit()" class="panel-collapse-indicator">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                <svg class="panel-collapse-indicator__icon--right" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </div>

            <!-- Left Panel -->
            <div x-show="!leftPanelCollapsed" class="panel panel--left" :class="{'panel--full-width': rightPanelCollapsed}" :style="!rightPanelCollapsed ? `width: ${leftWidth}%` : ''">

                <!-- Tabs -->
                <div class="tabs-header">
                    <div class="tabs-container">
                        <template x-for="tab in tabs" :key="tab.id">
                            <div class="tab"
                                :class="{ 'is-active': activeId === tab.id, 'is-dragging': draggingId === tab.id, 'is-drag-over': dropTargetId === tab.id && draggingId !== tab.id }"
                                draggable="true" @click="activeId = tab.id"
                                @dragstart="handleDragStart($event, tab.id)" @dragend="handleDragEnd()"
                                @dragover.prevent="handleDragOver(tab.id)" @drop.prevent="handleDrop(tab.id)">

                                <span class="tab__name" x-text="tab.name" @mouseenter="if ($el.scrollWidth > $el.clientWidth) showTooltip(tab.name, $el)" @mouseleave="hideTooltip"></span>

                                <button class="icon-button icon-button--close" @click.stop="removeTab(tab.id)" @mouseenter="showTooltip('Close Tab', $el)" @mouseleave="hideTooltip">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                </button>
                            </div>
                        </template>
                    </div>

                    <div class="tabs-actions">
                        <button @click="leftPanelCollapsed = true" :disabled="rightPanelCollapsed" @mouseenter="showTooltip('Collapse Panel', $el)" @mouseleave="hideTooltip" class="tabs-actions__button">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>
                        </button>
                        <button @click="addTab" @mouseenter="showTooltip('New Tab', $el)" @mouseleave="hideTooltip" class="tabs-actions__button tabs-actions__button--add">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        </button>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content custom-scroll">
                    <template x-for="tab in tabs" :key="tab.id">
                        <div x-show="tab.id === activeId" x-cloak>
                            <div class="tab-content__sticky-header">
                                <h2 class="tab-content__title">Hardcoded Service Inputs</h2>
                            </div>
                            <div class="input-list">
                                <!-- Expandable Object Input -->
                                <details class="input-item input-item--expandable" open>
                                    <summary>
                                        <div class="input-item__label">
                                            <span class="input-item__name">destination</span>
                                            <span class="input-item__type">interfaces/Pose</span>
                                        </div>
                                        <svg class="chevron-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                                    </summary>
                                    <div class="input-item__children">
                                        <div class="input-item">
                                            <div class="input-item__label">
                                                <span class="input-item__name">x</span>
                                                <span class="input-item__type">float64</span>
                                            </div>
                                            <input type="number" step="0.01" class="input-field">
                                        </div>
                                        <div class="input-item">
                                            <div class="input-item__label">
                                                <span class="input-item__name">y</span>
                                                <span class="input-item__type">float64</span>
                                            </div>
                                            <input type="number" step="0.01" class="input-field">
                                        </div>
                                    </div>
                                </details>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Resize Handle -->
            <div x-show="!leftPanelCollapsed && !rightPanelCollapsed" @mousedown="startResize" class="resize-handle">
                <div class="resize-handle__reset-button-wrapper">
                    <button class="icon-button" @click.stop="resetSplit" @mouseenter="showTooltip('Reset Layout', $el)" @mouseleave="hideTooltip">
                        <svg fill="currentColor" viewBox="0 0 36 36"><path d="M22.4,11.65a1.09,1.09,0,0,0,1.09,1.09H34.43V1.81a1.09,1.09,0,1,0-2.19,0V8.95a16.41,16.41,0,1,0,1.47,15.86,1.12,1.12,0,0,0-2.05-.9,14.18,14.18,0,1,1-1.05-13.36H23.5A1.09,1.09,0,0,0,22.4,11.65Z"></path></svg>
                    </button>
                </div>
                <div class="resize-handle__dots-wrapper">
                    <div class="resize-handle__dots">
                        <div class="resize-handle__dot"></div>
                        <div class="resize-handle__dot"></div>
                    </div>
                </div>
            </div>

            <!-- Right Panel (Terminal) -->
            <div x-show="!rightPanelCollapsed" class="panel panel--right" :class="{'panel--full-width': leftPanelCollapsed}" :style="!leftPanelCollapsed ? `width: ${100 - leftWidth}%` : ''">
                <div class="panel__header">
                    <div class="panel__header-title">Ubuntu Terminal Output</div>
                    <button @click="rightPanelCollapsed = true" :disabled="leftPanelCollapsed" @mouseenter="showTooltip('Collapse Panel', $el)" @mouseleave="hideTooltip" class="icon-button">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>
                    </button>
                </div>
                <!-- MODIFICATION: Terminal content is now empty -->
                <div class="panel__content custom-scroll"></div>
            </div>

            <!-- Right Panel Collapsed Indicator -->
            <div x-show="rightPanelCollapsed" x-cloak @click="rightPanelCollapsed = false; resetSplit()" class="panel-collapse-indicator">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                <svg class="panel-collapse-indicator__icon--left" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </div>
        </main>
    </div>

    <!-- Global Tooltip -->
    <div x-show="tooltip.open" x-cloak class="tooltip" :style="`top: ${tooltip.top}px; left: ${tooltip.left}px;`">
        <span x-text="tooltip.text"></span>
        <div class="tooltip__arrow"></div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('panelManager', () => ({
                tabs: [], activeId: null, nextId: 1, leftWidth: 50, leftPanelCollapsed: false, rightPanelCollapsed: false, tooltip: { open: false, text: '', top: 0, left: 0 }, draggingId: null, dropTargetId: null,
                init() { this.addTab(); },
                addTab() { const id = this.nextId++; this.tabs.push({ id, name: `Service Tab ${id}` }); this.activeId = id; },
                removeTab(id) {
                    const tabIndex = this.tabs.findIndex(t => t.id === id);
                    if (tabIndex === -1) return;
                    if (this.activeId === id) { this.activeId = this.tabs.length > 1 ? (this.tabs[tabIndex - 1] || this.tabs[tabIndex + 1]).id : null; }
                    this.tabs.splice(tabIndex, 1);
                    if (this.tabs.length === 0) { this.addTab(); }
                },
                handleDragStart(event, id) { this.draggingId = id; event.dataTransfer.effectAllowed = 'move'; },
                handleDragOver(targetId) { if (targetId !== this.draggingId) { this.dropTargetId = targetId; } },
                handleDrop(targetId) {
                    if (!this.draggingId || this.draggingId === targetId) { this.handleDragEnd(); return; }
                    const oldIndex = this.tabs.findIndex(s => s.id === this.draggingId);
                    const newIndex = this.tabs.findIndex(s => s.id === targetId);
                    if (oldIndex !== -1 && newIndex !== -1) { const movedItem = this.tabs.splice(oldIndex, 1)[0]; this.tabs.splice(newIndex, 0, movedItem); }
                    this.handleDragEnd();
                },
                handleDragEnd() { this.draggingId = null; this.dropTargetId = null; },
                startResize(event) {
                    event.preventDefault();
                    const container = this.$refs.container;
                    document.body.classList.add('is-resizing');
                    event.target.closest('.resize-handle').classList.add('is-active');
                    const moveHandler = (moveEvent) => {
                        const containerRect = container.getBoundingClientRect();
                        const newWidth = ((moveEvent.clientX - containerRect.left) / containerRect.width) * 100;
                        this.leftWidth = Math.max(20, Math.min(80, newWidth));
                    };
                    const endHandler = () => {
                        document.body.classList.remove('is-resizing');
                        document.querySelector('.resize-handle.is-active')?.classList.remove('is-active');
                        document.removeEventListener('mousemove', moveHandler);
                        document.removeEventListener('mouseup', endHandler);
                    };
                    document.addEventListener('mousemove', moveHandler);
                    document.addEventListener('mouseup', endHandler);
                },
                resetSplit() { this.leftWidth = 50; },
                showTooltip(text, el) {
                    if (!text) return;
                    const rect = el.getBoundingClientRect();
                    this.tooltip = { text, open: true, top: rect.top - 6, left: rect.left + rect.width / 2 };
                },
                hideTooltip() { this.tooltip.open = false; }
            }));
        });
    </script>
</body>

</html>
